<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Universo de Ana</title>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Dancing+Script:wght@700&family=Great+Vibes&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            overflow: hidden;
            background-color: #000;
            font-family: 'Arial', sans-serif;
            color: white;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .universe-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .universe-title {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            font-size: 42px;
            color: #ff4d88;
            font-family: 'Pacifico', cursive;
            text-shadow: 0 0 15px #ff4d88, 0 0 25px #ff4d88;
            z-index: 100;
            pointer-events: none;
            animation: pulse 3s infinite alternate;
        }

        .hidden {
            display: none !important;
        }

        .music-player {
            position: absolute;
            left: 20px;
            bottom: 20px;
            z-index: 100;
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 15px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
        }

        .music-btn {
            background: none;
            border: none;
            color: #ff4d88;
            font-size: 24px;
            cursor: pointer;
            margin-right: 10px;
            transition: transform 0.3s ease;
        }

        .music-btn:hover { transform: scale(1.2); }

        .music-info { font-size: 14px; color: #aabbcc; max-width: 150px; }

        .volume-control { margin-left: 10px; display: flex; align-items: center; }

        .volume-slider {
            width: 80px;
            margin-left: 8px;
            -webkit-appearance: none;
            height: 4px;
            border-radius: 2px;
            background: #555;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #ff4d88;
            cursor: pointer;
        }

        .galaxies-view, .galaxy-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #galaxiesCanvas, #galaxyCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .galaxy-names {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .galaxy-label {
            position: absolute;
            color: #aabbcc;
            font-family: 'Dancing Script', cursive;
            font-size: 18px;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
            pointer-events: auto;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.7;
            z-index: 20;
            transform: translate(-50%, -50%);
        }

        .galaxy-label:hover {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.2);
            color: #ff4d88;
        }

        .galaxy-header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, transparent 100%);
        }

        .back-button {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #ff4d88;
            color: #ff4d88;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Arial', sans-serif;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .back-button:hover {
            background: rgba(255, 77, 136, 0.2);
            transform: scale(1.05);
        }

        .galaxy-title {
            font-size: 32px;
            color: #ff4d88;
            font-family: 'Pacifico', cursive;
            text-shadow: 0 0 15px #ff4d88;
        }

        .galaxy-content {
            position: absolute;
            top: 80px;
            left: 0;
            width: 100%;
            height: calc(100% - 80px);
            z-index: 50;
            pointer-events: none;
        }

        /* Estilos específicos para la Galaxia de Amor */
        .love-message {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            font-size: 32px;
            color: #ff4d88;
            font-family: 'Pacifico', cursive;
            text-shadow: 0 0 15px #ff4d88, 0 0 25px #ff4d88;
            z-index: 100;
            pointer-events: none;
            animation: pulse 3s infinite alternate;
        }

        .discover-message {
            position: absolute;
            top: 70px;
            width: 100%;
            text-align: center;
            font-size: 18px;
            color: #aabbcc;
            font-family: 'Dancing Script', cursive;
            z-index: 100;
            opacity: 0.8;
            animation: fadeInOut 4s infinite alternate;
        }

        .instructions {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            font-size: 16px;
            color: #aabbcc;
            z-index: 100;
        }

        .zoom-indicator {
            position: absolute;
            right: 20px;
            bottom: 20px;
            color: #aabbcc;
            font-size: 14px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 10px;
            opacity: 0.7;
        }

        .love-text {
            position: absolute;
            color: #ff9ac9;
            font-size: 28px;
            font-weight: bold;
            text-shadow: 0 0 12px rgba(255, 105, 180, 0.9), 0 0 20px rgba(255, 105, 180, 0.6);
            pointer-events: none;
            z-index: 100;
            transform-origin: center;
            font-family: 'Dancing Script', cursive;
            opacity: 0;
            transition: opacity 0.8s ease, transform 0.8s ease;
            text-align: center;
            white-space: nowrap;
            will-change: transform, opacity;
            animation: float 8s infinite ease-in-out;
        }

        @keyframes pulse { 
            0% { transform: scale(1); } 
            100% { transform: scale(1.05); } 
        }
        
        @keyframes fadeInOut { 
            0%, 100% { opacity: 0.6; } 
            50% { opacity: 1; } 
        }
        
        @keyframes float { 
            0%, 100% { transform: translateY(0) rotate(0deg); } 
            50% { transform: translateY(-8px) rotate(3deg); } 
        }

        @keyframes particleFloat {
            0% { transform: translateY(0) rotate(0deg) scale(1); opacity: 0.8; }
            50% { transform: translateY(-10px) rotate(180deg) scale(1.2); opacity: 1; }
            100% { transform: translateY(0) rotate(360deg) scale(1); opacity: 0.8; }
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #fff;
            border-radius: 50%;
            pointer-events: none;
            animation: particleFloat 3s infinite ease-in-out;
        }

        @media (max-width: 700px) {
            .universe-title { font-size: 32px; }
            .music-player { left: 10px; bottom: 10px; padding: 8px 12px; }
            .galaxy-label { font-size: 14px; }
            .galaxy-title { font-size: 24px; }
            .back-button { padding: 8px 12px; font-size: 14px; }
            .love-message { font-size: 24px; top: 12px; }
            .discover-message { top: 52px; font-size: 16px; }
            .zoom-indicator { right: 10px; bottom: 10px; font-size: 12px; }
            .instructions { bottom: 12px; font-size: 13px; }
            .love-text { font-size: 20px; }
        }
    </style>
</head>
<body>
    <div class="universe-container" id="universeContainer">
        <div class="universe-title">Universo de Ana</div>
        
        <!-- Vista de galaxias -->
        <div class="galaxies-view" id="galaxiesView">
            <canvas id="galaxiesCanvas"></canvas>
            <div class="galaxy-names" id="galaxyNames"></div>
        </div>
        
        <!-- Vista de galaxia individual -->
        <div class="galaxy-view hidden" id="galaxyView">
            <div class="galaxy-header">
                <button class="back-button" id="backButton">← Volver al universo</button>
                <div class="galaxy-title" id="galaxyTitle"></div>
            </div>
            <canvas id="galaxyCanvas"></canvas>
            <div class="galaxy-content" id="galaxyContent"></div>
        </div>
        
        <!-- Controles de música -->
        <div class="music-player">
            <button class="music-btn" id="playPauseBtn">▶️</button>
            <div class="music-info">Keane - Somewhere Only We Know</div>
            <div class="volume-control">
                <span style="color: #aabbcc;">🔊</span>
                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="70">
            </div>
        </div>

        <!-- Reproductor de audio -->
        <audio id="backgroundMusic" loop muted>
            <source src="https://www.dropbox.com/scl/fi/ju447r9wmlj7r499nq42c/Keane-Somewhere-Only-We-Know-espa-ol-lyrics-_2_2.mp3?rlkey=dx6g00mnwmp3t46jml887ij49&st=b0ptd8bz&dl=1" type="audio/mpeg">
        </audio>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>

    <script>
        // ===== GALAXY MANAGER =====
        class GalaxyManager {
            constructor() {
                this.galaxies = [
                    { id: 'andromeda', name: 'Andrómeda', x: -40, y: 15, z: -80, size: 12 },
                    { id: 'ana', name: 'Galaxia Ana', x: 0, y: 0, z: -60, size: 15 },
                    { id: 'via-lactea', name: 'Vía Láctea', x: 35, y: -10, z: -70, size: 14 },
                    { id: 'triangulum', name: 'Triángulum', x: -30, y: -25, z: -90, size: 10 },
                    { id: 'sombrero', name: 'Galaxia Sombrero', x: 25, y: 30, z: -100, size: 11 },
                    { id: 'orion', name: 'Nebulosa de Orión', x: -20, y: 35, z: -50, size: 8 },
                    { id: 'centaurus', name: 'Centaurus A', x: 45, y: -15, z: -110, size: 11 },
                    { id: 'whirlpool', name: 'Galaxia Remolino', x: -35, y: -30, z: -60, size: 10 },
                    { id: 'black-eye', name: 'Galaxia Ojo Negro', x: 30, y: 25, z: -80, size: 8 },
                    { id: 'pinwheel', name: 'Galaxia Molinillo', x: -25, y: -35, z: -70, size: 10 }
                ];
                
                this.currentGalaxy = null;
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.galaxyMeshes = [];
                this.starField = null;
                this.particles = [];
            }
            
            init() {
                this.setupScene();
                this.createStarField();
                this.createGalaxies();
                this.createGalaxyLabels();
                this.animate();
                
                // Event listeners
                document.getElementById('backButton').addEventListener('click', () => this.showGalaxyView(false));
            }
            
            setupScene() {
                this.scene = new THREE.Scene();
                
                this.camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 2000);
                this.camera.position.z = 150;
                
                this.renderer = new THREE.WebGLRenderer({
                    canvas: document.getElementById('galaxiesCanvas'),
                    antialias: true,
                    alpha: true
                });
                
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.setClearColor(0x000011, 1);
                
                // Luz ambiental
                const ambientLight = new THREE.AmbientLight(0x333333);
                this.scene.add(ambientLight);
                
                // Luz direccional
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
                directionalLight.position.set(5, 3, 5);
                this.scene.add(directionalLight);
            }
            
            createStarField() {
                const starGeometry = new THREE.BufferGeometry();
                const starCount = 5000;
                const starPositions = new Float32Array(starCount * 3);
                
                for (let i = 0; i < starCount; i++) {
                    starPositions[i * 3] = (Math.random() - 0.5) * 2000;
                    starPositions[i * 3 + 1] = (Math.random() - 0.5) * 2000;
                    starPositions[i * 3 + 2] = (Math.random() - 0.5) * 2000;
                }
                
                starGeometry.setAttribute('position', new THREE.BufferAttribute(starPositions, 3));
                const starMaterial = new THREE.PointsMaterial({
                    color: 0xffffff,
                    size: 0.5,
                    sizeAttenuation: true,
                    transparent: true,
                    opacity: 0.8
                });
                
                this.starField = new THREE.Points(starGeometry, starMaterial);
                this.scene.add(this.starField);
            }
            
            createGalaxies() {
                this.galaxies.forEach(galaxy => {
                    const geometry = new THREE.SphereGeometry(galaxy.size, 32, 32);
                    let material;
                    
                    // Materiales diferentes para cada galaxia
                    if (galaxy.id === 'ana') {
                        material = new THREE.MeshPhongMaterial({
                            color: 0xff4d88,
                            emissive: 0x440022,
                            specular: 0xff88aa,
                            shininess: 100,
                            transparent: true,
                            opacity: 0.9
                        });
                    } else {
                        const hue = Math.random();
                        material = new THREE.MeshPhongMaterial({
                            color: new THREE.Color().setHSL(hue, 0.7, 0.5),
                            emissive: new THREE.Color().setHSL(hue, 0.5, 0.2),
                            specular: new THREE.Color().setHSL(hue, 0.8, 0.7),
                            shininess: 80,
                            transparent: true,
                            opacity: 0.8
                        });
                    }
                    
                    const mesh = new THREE.Mesh(geometry, material);
                    mesh.position.set(galaxy.x, galaxy.y, galaxy.z);
                    mesh.userData = { galaxyId: galaxy.id };
                    
                    this.scene.add(mesh);
                    this.galaxyMeshes.push(mesh);
                    
                    // Añadir efecto de corona para galaxias espirales
                    if (Math.random() > 0.3) {
                        const coronaGeometry = new THREE.RingGeometry(galaxy.size * 1.1, galaxy.size * 1.5, 32);
                        const coronaMaterial = new THREE.MeshBasicMaterial({
                            color: material.emissive,
                            side: THREE.DoubleSide,
                            transparent: true,
                            opacity: 0.3
                        });
                        
                        const corona = new THREE.Mesh(coronaGeometry, coronaMaterial);
                        corona.rotation.x = Math.PI / 2;
                        mesh.add(corona);
                    }
                });
            }
            
            createGalaxyLabels() {
                const namesContainer = document.getElementById('galaxyNames');
                
                this.galaxies.forEach(galaxy => {
                    const label = document.createElement('div');
                    label.className = 'galaxy-label';
                    label.textContent = galaxy.name;
                    label.dataset.galaxyId = galaxy.id;
                    
                    // Calcular posición en pantalla basada en posición 3D
                    const vector = new THREE.Vector3(galaxy.x, galaxy.y, galaxy.z);
                    vector.project(this.camera);
                    
                    const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                    const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;
                    
                    label.style.left = `${x}px`;
                    label.style.top = `${y}px`;
                    
                    namesContainer.appendChild(label);
                    
                    // Event listener para clic en galaxia
                    label.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.selectGalaxy(galaxy.id);
                    });
                });
                
                // También hacer clicable las propias galaxias 3D
                this.addGalaxyClickEvents();
            }
            
            addGalaxyClickEvents() {
                const raycaster = new THREE.Raycaster();
                const mouse = new THREE.Vector2();
                
                const onMouseClick = (event) => {
                    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                    mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
                    
                    raycaster.setFromCamera(mouse, this.camera);
                    const intersects = raycaster.intersectObjects(this.galaxyMeshes);
                    
                    if (intersects.length > 0) {
                        const galaxyId = intersects[0].object.userData.galaxyId;
                        this.selectGalaxy(galaxyId);
                    }
                };
                
                document.getElementById('galaxiesCanvas').addEventListener('click', onMouseClick);
            }
            
            selectGalaxy(galaxyId) {
                const galaxy = this.galaxies.find(g => g.id === galaxyId);
                if (!galaxy) return;
                
                this.currentGalaxy = galaxy;
                
                // Crear efecto de partículas para galaxias que no son Ana
                if (galaxyId !== 'ana') {
                    this.createParticleEffect(galaxy);
                }
                
                this.showGalaxyView(true);
            }
            
            createParticleEffect(galaxy) {
                // Limpiar partículas anteriores
                this.clearParticles();
                
                // Crear partículas alrededor de la galaxia seleccionada
                const particleCount = 50;
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    
                    // Posicionar partículas en un patrón circular alrededor de la galaxia
                    const angle = (i / particleCount) * Math.PI * 2;
                    const distance = galaxy.size * 2.5;
                    
                    const vector = new THREE.Vector3(
                        galaxy.x + Math.cos(angle) * distance,
                        galaxy.y + Math.sin(angle) * distance,
                        galaxy.z
                    );
                    
                    vector.project(this.camera);
                    
                    const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                    const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;
                    
                    particle.style.left = `${x}px`;
                    particle.style.top = `${y}px`;
                    particle.style.animationDelay = `${i * 0.1}s`;
                    
                    document.getElementById('galaxiesView').appendChild(particle);
                    this.particles.push(particle);
                }
            }
            
            clearParticles() {
                this.particles.forEach(particle => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                });
                this.particles = [];
            }
            
            showGalaxyView(show) {
                const galaxiesView = document.getElementById('galaxiesView');
                const galaxyView = document.getElementById('galaxyView');
                const galaxyTitle = document.getElementById('galaxyTitle');
                
                if (show && this.currentGalaxy) {
                    galaxiesView.classList.add('hidden');
                    galaxyView.classList.remove('hidden');
                    galaxyTitle.textContent = this.currentGalaxy.name;
                    
                    // Limpiar partículas al entrar a una galaxia
                    this.clearParticles();
                    
                    // Cargar contenido específico de la galaxia
                    this.loadGalaxyContent(this.currentGalaxy.id);
                } else {
                    // Limpiar textos de amor al salir de la galaxia Ana
                    if (this.currentGalaxy && this.currentGalaxy.id === 'ana') {
                        const loveTexts = document.querySelectorAll('.love-text');
                        loveTexts.forEach(text => text.remove());
                    }
                    
                    galaxyView.classList.add('hidden');
                    galaxiesView.classList.remove('hidden');
                    this.currentGalaxy = null;
                    
                    // Limpiar partículas al volver al universo
                    this.clearParticles();
                }
            }
            
            loadGalaxyContent(galaxyId) {
                const contentContainer = document.getElementById('galaxyContent');
                contentContainer.innerHTML = '';
                
                switch(galaxyId) {
                    case 'ana':
                        // Cargar la galaxia de amor
                        initLoveGalaxy();
                        break;
                    default:
                        // Contenido placeholder para otras galaxias
                        contentContainer.innerHTML = `
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; pointer-events: none;">
                                <h2 style="font-family: 'Pacifico', cursive; color: #ff4d88; margin-bottom: 20px;">
                                    ${this.currentGalaxy.name}
                                </h2>
                                <p style="font-family: 'Dancing Script', cursive; font-size: 24px;">
                                    Próximamente más contenido para esta galaxia
                                </p>
                            </div>
                        `;
                }
            }
            
            animate() {
                requestAnimationFrame(() => this.animate());
                
                // Rotar galaxias lentamente
                this.galaxyMeshes.forEach(mesh => {
                    mesh.rotation.y += 0.001;
                    if (mesh.children.length > 0) {
                        mesh.children[0].rotation.z += 0.002;
                    }
                });
                
                // Rotar campo de estrellas muy lentamente
                if (this.starField) {
                    this.starField.rotation.y += 0.0001;
                }
                
                // Actualizar posiciones de las etiquetas
                this.updateGalaxyLabels();
                
                this.renderer.render(this.scene, this.camera);
            }
            
            updateGalaxyLabels() {
                const labels = document.querySelectorAll('.galaxy-label');
                labels.forEach((label, index) => {
                    const galaxy = this.galaxies[index];
                    if (!galaxy) return;
                    
                    const vector = new THREE.Vector3(galaxy.x, galaxy.y, galaxy.z);
                    vector.project(this.camera);
                    
                    // Solo mostrar etiquetas que están frente a la cámara
                    if (vector.z < 1) {
                        const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                        const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;
                        
                        label.style.display = 'block';
                        label.style.left = `${x}px`;
                        label.style.top = `${y}px`;
                    } else {
                        label.style.display = 'none';
                    }
                });
                
                // Actualizar partículas si existen
                if (this.particles.length > 0 && this.currentGalaxy && this.currentGalaxy.id !== 'ana') {
                    this.updateParticles();
                }
            }
            
            updateParticles() {
                const galaxy = this.currentGalaxy;
                this.particles.forEach((particle, i) => {
                    const angle = (i / this.particles.length) * Math.PI * 2 + Date.now() * 0.001;
                    const distance = galaxy.size * 2.5;
                    
                    const vector = new THREE.Vector3(
                        galaxy.x + Math.cos(angle) * distance,
                        galaxy.y + Math.sin(angle) * distance,
                        galaxy.z
                    );
                    
                    vector.project(this.camera);
                    
                    const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                    const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;
                    
                    particle.style.left = `${x}px`;
                    particle.style.top = `${y}px`;
                });
            }
            
            onWindowResize() {
                if (this.camera && this.renderer) {
                    this.camera.aspect = window.innerWidth / window.innerHeight;
                    this.camera.updateProjectionMatrix();
                    this.renderer.setSize(window.innerWidth, window.innerHeight);
                }
            }
        }

        // ===== LOVE GALAXY (CÓDIGO ORIGINAL COMPLETO) =====
        function initLoveGalaxy() {
            // Detección simple de móvil para optimizaciones
            const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent) || window.innerWidth < 760;

            // Variables principales (idénticas a las tuyas)
            let scene, camera, renderer, controls;
            let blackHole, accretionDisk;
            let starField;
            let loveTexts = [];
            let zoomIndicator;
            let isPlaying = false;

            // Mensajes (los tuyos, inalterados)
            const loveMessages = [
                "Te amo", "Te quiero", "Me encantas", "Te adoro", 
                "Eres mi persona favorita", "Eres mi sueño", "Eres mi todo", 
                "Eres hermosa", "Eres única", "Eres especial", 
                "Eres increíble", "Eres perfecta", "Eres maravillosa", 
                "Eres mi sol", "Eres mi luz", "Eres mi alegría", 
                "Eres mi inspiración", "Eres mi razón", "Eres mi destino", 
                "Eres mi felicidad", "Eres mi paz", "Eres mi vida", 
                "Eres mi amor", "Eres mi cielo", "Eres mi estrella", 
                "Eres mi universo", "Eres mi todo", "Eres mi pasión", 
                "Eres mi deseo", "Eres mi energía", "Eres mi fortuna", 
                "Eres mi complemento", "Eres mi media naranja", "Eres mi alma gemela", 
                "Eres mi complicidad", "Eres mi confidente", "Eres mi refugio", 
                "Eres mi hogar", "Eres mi ritmo", "Eres mi melodía", 
                "Eres mi poesía", "Eres mi arte", "Eres mi musa", 
                "Eres mi canción", "Eres mi baile", "Eres mi viaje", 
                "Eres mi aventura", "Eres mi descanso", "Eres mi norte", 
                "Eres mi sur", "Eres mi este", "Eres mi oeste", 
                "Eres mi día", "Eres mi noche", "Eres mi amanecer", 
                "Eres mi atardecer", "Eres mi verano", "Eres mi invierno", 
                "Eres mi primavera", "Eres mi otoño", "Eres mi risa", 
                "Eres mi llanto", "Eres mi silencio", "Eres mi voz", 
                "Eres mi fuerza", "Eres mi vulnerabilidad", "Eres mi certeza", 
                "Eres mi duda", "Eres mi quietud", "Eres mi movimiento", 
                "Eres mi paz", "Eres mi guerra", "Eres mi Yin", 
                "Eres mi Yang", "Eres mi equilibrio", "Eres mi caos", 
                "Eres mi comienzo", "Eres mi final", "Eres mi infinito", 
                "Eres mi eternidad", "Eres mi presente", "Eres mi futuro", 
                "Eres mi pasado", "Eres mi historia", "Eres mi realidad", 
                "Eres mi fantasía", "Eres mi magia", "Eres mi milagro", 
                "Eres mi tesoro", "Eres mi regalo", "Eres mi bendición", 
                "Eres mi sonrisa", "Eres mi mirada", "Eres mi respiro", 
                "Eres mi latido", "Eres mi calor", "Eres mi frío", 
                "Eres mi fuego", "Eres mi agua", "Eres mi tierra", 
                "Eres mi aire", "Eres mi esencia", "Eres mi existencia"
            ];

            // Lista reducida para móviles (menos DOM)
            const loveMessagesMobile = loveMessages.slice(0, 40); // primeros 40 en móvil

            // Añadir elementos de interfaz para la galaxia de amor
            const contentContainer = document.getElementById('galaxyContent');
            contentContainer.innerHTML = `
                <div class="love-message">Eres el centro de mi universo Ana</div>
                <div class="discover-message">Explora el universo para descubrir mensajes de amor</div>
                <div class="instructions">Haz clic y arrastra para girar en 3D • Rueda del mouse para zoom</div>
                <div class="zoom-indicator">Zoom: 100%</div>
            `;

            // Inicializar Three.js
            function init() {
                scene = new THREE.Scene();

                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.z = 8;

                renderer = new THREE.WebGLRenderer({
                    canvas: document.getElementById('galaxyCanvas'),
                    antialias: true,
                    alpha: true,
                    powerPreference: "high-performance"
                });

                // Limitar devicePixelRatio para no forzar móviles de forma innecesaria
                const DPR = Math.min(window.devicePixelRatio || 1, 2);
                renderer.setPixelRatio(DPR);
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setClearColor(0x000000);

                // Controles (táctiles incluidos)
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.rotateSpeed = isMobile ? 0.6 : 1.0; // velocidad más baja en móvil
                controls.zoomSpeed = isMobile ? 0.8 : 1.2;
                controls.enablePan = false;

                zoomIndicator = document.querySelector('.zoom-indicator');

                // Crear escena: agujero negro, disco, estrellas y textos
                createRealisticBlackHole();
                createRealisticAccretionDisk();
                createStarField();
                createLoveTexts();

                // Luces
                const ambientLight = new THREE.AmbientLight(0x333333);
                scene.add(ambientLight);
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
                directionalLight.position.set(5, 3, 5);
                scene.add(directionalLight);

                // Resize with debounce (mejor rendimiento)
                let resizeTimeout = null;
                window.addEventListener('resize', () => {
                    if (resizeTimeout) clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(onWindowResize, 120);
                }, { passive: true });

                // Start animation
                animate();
            }

            // Crear agujero negro (igual que tu original)
            function createRealisticBlackHole() {
                const geometry = new THREE.SphereGeometry(1, 64, 64);
                const material = new THREE.MeshPhongMaterial({
                    color: 0x000000,
                    emissive: 0x220022,
                    specular: 0x330033,
                    shininess: 100,
                    transparent: true,
                    opacity: 0.95
                });
                blackHole = new THREE.Mesh(geometry, material);
                scene.add(blackHole);

                const coronaGeometry = new THREE.SphereGeometry(1.1, 64, 64);
                const coronaMaterial = new THREE.ShaderMaterial({
                    uniforms: { intensity: { value: 2.0 }, time: { value: 0 } },
                    vertexShader: `
                        varying vec3 vNormal;
                        varying vec2 vUv;
                        void main() {
                            vNormal = normalize(normalMatrix * normal);
                            vUv = uv;
                            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                        }
                    `,
                    fragmentShader: `
                        varying vec3 vNormal;
                        varying vec2 vUv;
                        uniform float intensity;
                        uniform float time;
                        void main() {
                            float fresnel = pow(1.0 - abs(dot(vNormal, vec3(0.0,0.0,1.0))), 3.0);
                            float waves = sin((vUv.x * 10.0) + time) * 0.5 + 0.5;
                            float opacity = fresnel * intensity * (0.7 + 0.3 * waves);
                            vec3 coronaColor = mix(vec3(0.3,0.1,0.5), vec3(0.5,0.2,0.6), waves);
                            gl_FragColor = vec4(coronaColor, opacity * 0.8);
                        }
                    `,
                    transparent: true,
                    side: THREE.BackSide,
                    blending: THREE.AdditiveBlending
                });
                const corona = new THREE.Mesh(coronaGeometry, coronaMaterial);
                scene.add(corona);
            }

            // Crear disco de acreción (igual que tu original)
            function createRealisticAccretionDisk() {
                const diskGeometry = new THREE.RingGeometry(1.2, 3.5, 128);
                const diskMaterial = new THREE.ShaderMaterial({
                    uniforms: { time: { value: 0 }, innerRadius: { value: 1.2 }, outerRadius: { value: 3.5 } },
                    vertexShader: `
                        varying vec2 vUv;
                        void main() {
                            vUv = uv;
                            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                        }
                    `,
                    fragmentShader: `
                        varying vec2 vUv;
                        uniform float time;
                        uniform float innerRadius;
                        uniform float outerRadius;
                        void main() {
                            float radius = (vUv.x * (outerRadius - innerRadius) + innerRadius);
                            float normalizedRadius = (radius - innerRadius) / (outerRadius - innerRadius);
                            vec3 color1 = vec3(0.8,0.4,0.2);
                            vec3 color2 = vec3(0.6,0.2,0.8);
                            vec3 color3 = vec3(0.2,0.4,0.9);
                            vec3 finalColor;
                            if (normalizedRadius < 0.3) {
                                finalColor = mix(color1, color2, normalizedRadius / 0.3);
                            } else if (normalizedRadius < 0.7) {
                                finalColor = mix(color2, color3, (normalizedRadius - 0.3) / 0.4);
                            } else {
                                finalColor = color3;
                            }
                            float timeVariation = sin(time * 0.5 + normalizedRadius * 10.0) * 0.5 + 0.5;
                            finalColor *= (0.8 + 0.2 * timeVariation);
                            float alpha = 1.0 - smoothstep(0.7, 1.0, normalizedRadius);
                            alpha *= 0.9;
                            gl_FragColor = vec4(finalColor, alpha);
                        }
                    `,
                    transparent: true,
                    side: THREE.DoubleSide,
                    blending: THREE.AdditiveBlending
                });
                accretionDisk = new THREE.Mesh(diskGeometry, diskMaterial);
                accretionDisk.rotation.x = Math.PI/2;
                scene.add(accretionDisk);

                const innerDiskGeometry = new THREE.RingGeometry(1.1, 1.8, 64);
                const innerDiskMaterial = new THREE.ShaderMaterial({
                    uniforms: { time: { value: 0 } },
                    vertexShader: `
                        varying vec2 vUv;
                        void main() {
                            vUv = uv;
                            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                        }
                    `,
                    fragmentShader: `
                        varying vec2 vUv;
                        uniform float time;
                        void main() {
                            float intensity = sin(time * 2.0 + vUv.x * 20.0) * 0.5 + 0.5;
                            vec3 hotColor = mix(vec3(1.0,0.9,0.5), vec3(1.0,0.5,0.2), intensity);
                            float alpha = 1.0 - smoothstep(0.0, 1.0, vUv.x);
                            alpha *= 0.9;
                            gl_FragColor = vec4(hotColor, alpha);
                        }
                    `,
                    transparent: true,
                    side: THREE.DoubleSide,
                    blending: THREE.AdditiveBlending
                });
                const innerDisk = new THREE.Mesh(innerDiskGeometry, innerDiskMaterial);
                innerDisk.rotation.x = Math.PI/2;
                scene.add(innerDisk);
            }

            // Crear campo de estrellas (reducido en móvil)
            function createStarField() {
                const starGeometry = new THREE.BufferGeometry();
                // Ajuste: menos estrellas para móvil
                const count = isMobile ? 4500 : 15000;
                const starVertices = new Float32Array(count * 3);
                for (let i = 0; i < count; i++) {
                    starVertices[i*3] = (Math.random() - 0.5) * 2500;
                    starVertices[i*3 + 1] = (Math.random() - 0.5) * 2500;
                    starVertices[i*3 + 2] = (Math.random() - 0.5) * 2500;
                }
                starGeometry.setAttribute('position', new THREE.BufferAttribute(starVertices, 3));
                const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: isMobile ? 0.08 : 0.1, transparent: true, blending: THREE.AdditiveBlending });
                starField = new THREE.Points(starGeometry, starMaterial);
                scene.add(starField);
            }

            // Crear textos amorosos (limitar en móvil para menos DOM)
            function createLoveTexts() {
                const textContainer = document.body;
                const msgs = isMobile ? loveMessagesMobile : loveMessages;
                loveTexts = [];

                msgs.forEach((msg, index) => {
                    const textElement = document.createElement('div');
                    textElement.className = 'love-text';
                    textElement.textContent = msg;
                    textElement.style.animation = `float ${8 + Math.random() * 8}s infinite ease-in-out`;
                    textElement.style.animationDelay = `${Math.random() * 5}s`;

                    // Mantener tus fuentes
                    const fonts = ['Dancing Script', 'Pacifico', 'Great Vibes', 'cursive'];
                    textElement.style.fontFamily = fonts[Math.floor(Math.random() * fonts.length)];

                    // Tamaño aleatorio
                    const baseSize = isMobile ? 20 : 28;
                    const sizeVariation = Math.random() * (isMobile ? 8 : 12);
                    textElement.style.fontSize = `${baseSize + sizeVariation}px`;

                    textContainer.appendChild(textElement);

                    // Distribución en capas esféricas (tu algoritmo original)
                    const layer = Math.floor(index / 30);
                    const distance = 5 + (layer * 8) + (Math.random() * 6);
                    const phi = Math.acos(-1 + (2 * (index % 30)) / 30);
                    const theta = Math.sqrt(30 * Math.PI) * phi;

                    const x = distance * Math.cos(theta) * Math.sin(phi);
                    const y = distance * Math.sin(theta) * Math.sin(phi);
                    const z = distance * Math.cos(phi);

                    const variation = 2;
                    loveTexts.push({
                        element: textElement,
                        position: new THREE.Vector3(
                            x + (Math.random() - 0.5) * variation,
                            y + (Math.random() - 0.5) * variation,
                            z + (Math.random() - 0.5) * variation
                        ),
                        size: parseFloat(textElement.style.fontSize),
                        visible: false
                    });
                });
            }

            // Actualizar posiciones 2D de textos (optimizado)
            function updateTextPositions() {
                if (!camera) return;
                const cameraDistance = camera.position.length();
                const zoomLevel = Math.max(10, Math.min(200, Math.round(1000 / cameraDistance)));
                if (zoomIndicator) zoomIndicator.textContent = `Zoom: ${zoomLevel}%`;

                // Loop simple, evitar layout thrashing: set styles in variables then apply
                for (let i = 0; i < loveTexts.length; i++) {
                    const text = loveTexts[i];
                    const vector = text.position.clone();
                    vector.project(camera);
                    // outside near plane skip
                    if (vector.z >= 1) {
                        if (text.element.style.display !== 'none') text.element.style.display = 'none';
                        text.visible = false;
                        continue;
                    }
                    const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                    const y = (-(vector.y * 0.5) + 0.5) * window.innerHeight;
                    const textDistance = text.position.distanceTo(camera.position);
                    // scale & opacity
                    const scale = Math.max(0.3, Math.min(2, 15 / textDistance));
                    let opacity = 0;
                    if (textDistance < 15) {
                        opacity = Math.max(0.3, Math.min(1, (15 - textDistance) / 10));
                    }

                    // Apply styles
                    const el = text.element;
                    el.style.display = 'block';
                    el.style.left = `${x}px`;
                    el.style.top = `${y}px`;
                    el.style.transform = `translate(-50%, -50%) scale(${scale})`;
                    el.style.opacity = opacity;
                    text.visible = (textDistance < 20);
                }

                // Update discover-message
                const visibleTexts = loveTexts.filter(t => t.visible).length;
                const discoverMessage = document.querySelector('.discover-message');
                if (discoverMessage) {
                    if (visibleTexts === 0) {
                        discoverMessage.textContent = "Explora el universo para descubrir mensajes de amor";
                    } else if (visibleTexts < 5) {
                        discoverMessage.textContent = `Has encontrado ${visibleTexts} mensaje${visibleTexts !== 1 ? 's' : ''} de amor`;
                    } else {
                        discoverMessage.textContent = `¡Wow! Has descubierto ${visibleTexts} mensajes de amor`;
                    }
                }
            }

            function onWindowResize() {
                if (!camera || !renderer) return;
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
                updateTextPositions();
            }

            // Animación principal (optimizado)
            function animate() {
                requestAnimationFrame(animate);

                // actualizar tiempo en shaders si existe
                try {
                    if (accretionDisk && accretionDisk.material && accretionDisk.material.uniforms && accretionDisk.material.uniforms.time) {
                        accretionDisk.material.uniforms.time.value += 0.01;
                    }
                } catch (e) {}

                if (accretionDisk) accretionDisk.rotation.z += isMobile ? 0.0015 : 0.002;
                if (starField) starField.rotation.y += isMobile ? 0.0003 : 0.0005;

                updateTextPositions();
                if (controls) controls.update();
                if (renderer && scene && camera) renderer.render(scene, camera);
            }

            // Inicializar todo
            init();
        }

        // ===== MAIN INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar el gestor de galaxias
            const galaxyManager = new GalaxyManager();
            galaxyManager.init();
            
            // Configurar controles de música
            setupMusicControls();
            
            // Manejar redimensionado de ventana
            window.addEventListener('resize', () => {
                galaxyManager.onWindowResize();
            });
        });

        function setupMusicControls() {
            const backgroundMusic = document.getElementById('backgroundMusic');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const volumeSlider = document.getElementById('volumeSlider');
            let isPlaying = false;
            
            // Configurar música
            if (backgroundMusic) {
                backgroundMusic.volume = volumeSlider ? volumeSlider.value / 100 : 0.7;
            }
            
            // Controles de play/pause
            if (playPauseBtn) {
                playPauseBtn.addEventListener('click', function() {
                    if (!backgroundMusic) return;
                    
                    if (isPlaying) {
                        backgroundMusic.pause();
                        this.innerHTML = '▶️';
                    } else {
                        backgroundMusic.play().catch(e => {
                            console.log("Error al reproducir audio:", e);
                        });
                        this.innerHTML = '⏸️';
                    }
                    isPlaying = !isPlaying;
                });
            }
            
            // Control de volumen
            if (volumeSlider) {
                volumeSlider.addEventListener('input', function() {
                    if (backgroundMusic) {
                        backgroundMusic.volume = this.value / 100;
                    }
                });
            }
            
            // Activar audio con la primera interacción del usuario
            const activateAudio = function() {
                if (backgroundMusic) {
                    backgroundMusic.muted = false;
                    // Intentar reproducir si no está reproduciéndose
                    if (backgroundMusic.paused) {
                        backgroundMusic.play().catch(e => {
                            console.log("Audio no pudo reproducirse:", e);
                        });
                    }
                }
                document.removeEventListener('click', activateAudio);
                document.removeEventListener('touchstart', activateAudio);
            };
            
            document.addEventListener('click', activateAudio);
            document.addEventListener('touchstart', activateAudio);
        }
    </script>
</body>
</html>